<!DOCTYPE>
<html>
	<head>
		<title>Trips</title>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
	</head>
	<body>
		<div id="content">
		
		</div>
		<script type="text/html" id="trip_tmpl">
			<div class="trip">
				<h2>${distance}<sub>miles</sub></h2>
				<div class="thumbs">
					<img src="http://dashboard.mileageapp.co/api/asset/matt/${id}-end">
					<img src="http://dashboard.mileageapp.co/api/asset/matt/${id}-start">
				</div>
			</div>
		</script>
		<style>
			#content {
				width: 320px;
				position: absolute;
				left: 50%;
				margin-left: -160px;
				border: 1px solid #333;
			}
			.trip {
				width: 320px;
				box-sizing: border-box;
				padding: 10px 20px;
			}
			.trip h2 {
				float: left;
				font-family: 'Helvetica Neue';
				font-weight: lighter;
				margin-right: 20px;
			}
			.trip h2 sub {
				display: block;
			}
			.trip .thumbs img {
				width: 100px;
			}
			.trip .thumbs {
				height: 75px;
				overflow: hidden;
			}
		</style>
		<script>
			var cookie = (function(cookie) {
				var dict = {};
				cookie.split(/;\s?/).forEach(function(pair) {
					if( pair.split('=').length == 2 ) {
						pair = pair.split('=');
						dict[pair[0]] = pair[1];
					}
				});
				return dict;
			}(document.cookie));
			if( !cookie.token ) {
				// handle error...
			} else {
				$.get('/api/trips/'+cookie.username+'?token='+cookie.token, function(data) {
					var trips = JSON.parse(data).trips;
					var tmpl = $("#trip_tmpl").text();
					trips.map(function(trip) {
						return tmpl.replace(/\$\{([^}]+)\}/g, function($0, $1) {
							return trip[$1];
						});
					}).forEach(function(trip) {
						$("#content").append(trip);
					});
				});
			}
		</script>
	</body>
</html>